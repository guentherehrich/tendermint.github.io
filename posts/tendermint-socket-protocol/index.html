



<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base href="http://tendermint.com">
  <title>The Tendermint Socket Protocol (TMSP) - Tendermint: The Enterprise Blockchain Platform</title>
  <link rel="canonical" href="http://tendermint.com/posts/tendermint-socket-protocol/">
  <meta content="on" http-equiv="cleartype" />
<meta content="width=device-width, initial-scale=1.0" name="viewport" /> 
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="/images/favicon.ico">

<link rel="stylesheet" type="text/css" media="screen" href="styles/screen.css">
<link rel="stylesheet" type="text/css" media="screen" href="styles/highlightjs/default.css">



</head>


<body id="body-post" class="body-article site-articles">
  <header id="site-header" class="site-bookend">
<div class="site-logo">
  <a href="/"><img src="images/tm-logo-white-640.png" alt="Tendermint logo"/></a>
</div>
<ul class="right">
  <li id="nav-spec"><a href="http://github.com/tendermint/tendermint/wiki">Spec</a></li>
  <li id="nav-forum"><a href="http://forum.tendermint.com/">Forum</a></li>
</ul>
<ul class="left">
  <li id="nav-blog"><a href="/posts/">Blog</a></li>
  <li id="nav-tutorials"><a href="/tutorials/">Tutorials</a></li>
  
</ul>
</header>


  <section id="section-hero">
    <div class="container">
      <h1>The Tendermint Socket Protocol (TMSP)</h1>
      <p>December 19, 2015</p>
      
<ul class="categories">
  
    <li><a href="/categories/tmsp">TMSP</a> </li>
  
</ul>

    </div>
  </section>

  
  <section id="section-post">
    
    <div class="container article-body">
      

<h3 id="motivation:9ee5291616336eaccb53b94be2d99fab">Motivation</h3>

<p>Thus far, all blockchains &ldquo;stacks&rdquo; (such as <a href="https://github.com/bitcoin/bitcoin">Bitcoin</a>) have had a monolithic design.  That is, each blockchain stack is a single program that handles all the concerns of a decentralized ledger; this includes P2P connectivity, the &ldquo;mempool&rdquo; broadcasting of transactions, consensus on the most recent block, account balances, Turing-complete contracts, user-level permissions, etc.</p>

<p>This approach to blockchain development has several problems.  First, creating a new blockchain requires forking an existing blockchain stack, and this comes with the cost of complexity.  First you need to understand all the components of a blockchain stack, even those that aren&rsquo;t directly relevant to the logic of your application.  This is especially true when the codebase is not modular in design and suffers from &ldquo;spaghetti code&rdquo;.</p>

<p>Another problem with this approach is that it limits you to the language of the blockchain stack (or vice versa).  In the case of Ethereum which supports a Turing-complete bytecode virtual-machine, it limits you to languages that compile down to that bytecode; today, those are Serpent and Solidity.</p>

<p>If we could only split a blockchain into two so that a standalone &ldquo;business logic&rdquo; application speaks to the rest of the blockchain via a language-agnostic socket protocol, we wouldn&rsquo;t be limited in this way.  Lo and behold, TMSP is that socket protocol.  Implementing TMSP is the easiest way to develop a new blockchain app.  You don&rsquo;t need to fork a whole blockchain stack, and you can program your application in any language.</p>

<p>The other half of TMSP is the <a href="https://github.com/tendermint/tendermint">Tendermint Core</a> program (the &ldquo;consensus engine&rdquo;).  Tendermint Core speaks to your TMSP application via a socket connection to empower it with the best propoerties of blockchains, including optimal Byzantine fault-tolerant consensus, P2P connectivity, transaction mempool, blockchain storage, and more.  Of course, you&rsquo;re not limited to Tendermint Core.  In the future there will likely be alternative consensu engines to choose from.  You&rsquo;re not locked in to Tendermint Core with TMSP.</p>

<p>As an added benefit, designing your blockchain app to support TMSP is a great way to make your application more modular and testable.</p>

<h3 id="intro-to-tmsp:9ee5291616336eaccb53b94be2d99fab">Intro to TMSP</h3>

<p>The Tendermint Socket Protocol (TMSP) and Tendermint Core are a set of tools for building blockchain based databases. Blockchains are a system for creating shared multi-master application state. The Tendermint Core approach is to decouple the consensus engine and P2P layer from the details of the application state of the particular blockchain.</p>

<p>To draw an analogy, lets talk about a well-known cryptocurrency, Bitcoin.  Bitcoin creates a cryptocurrency from a blockchain by having each full node maintain a fully audited Unspent Transaction Output (UTXO) database. If one wanted to create a Bitcoin like system on top of TMSP, Tendermint Core would be responsible for</p>

<ul>
<li>Sharing blocks and transactions between nodes</li>
<li>Establishing a canonical/immutable order of transactions (the blockchain)</li>
</ul>

<p>The Applications developer will be responsible for</p>

<ul>
<li>Maintaining the UTXO database</li>
<li>Validating cryptographic signatures of transactions</li>
<li>Preventing transactions from spending non-existent transactions
Allowing clients to query the UTXO database.</li>
</ul>

<p>Tendermint is able to decompose the blockchain design by offering a very simple API between the application layer and consensus layer.</p>

<p>The API consists of 4 primary message types from the consensus engine that the application layer needs to respond to.</p>

<p>The messages are specified here:
<a href="https://github.com/tendermint/tmsp#message-types">https://github.com/tendermint/tmsp#message-types</a></p>

<p>The <code>AppendTx</code> message type is the work horse of the Application. Each transaction from the blockchain is delivered with this message. The developer needs to validate each transactions received with the <code>AppendTx</code> message against the current state, application protocol, and the cryptographic credentials of the transaction. A validated transaction then needs to update the application state — by binding a value into a key values store, or by updating the UTXO database.</p>

<p>The purpose of the <code>GetHash</code> message is to allow a cryptographic commitment to the current application state to be placed into the next block header. This has some handy properties. Inconsistencies in updating that state will now appear as blockchain forks which catches a whole class of programming errors. This also simplifies the development of secure lightweight clients.</p>

<p>Finally, in order to recover from faulty proposers (e.g. a malicious validator that proposes two conflicting blocks), the application must be able to roll back transactions.  The <code>Commit</code> message tells the application to create a checkpoint, and the <code>Rollback</code> message to unwind the state back to that checkpoint.</p>

<p>There can be multiple TMSP socket connections to an application.  Each connection has an isolated “view” of the application state, but <code>Commit</code>/<code>Rollback</code> work across connections. Application developers can store the application state in an immutable data structure (such as Tendermint’s Go-Merkle library) to make this easy to develop.</p>

<p>NOTE: Tendermint Core creates two TMSP connections to the application; one for the validation of transactions when broadcasting in the mempool layer, and another for the consensus engine to run block proposals.  A commit on one connection followed by a rollback on the other syncs both views.</p>

<p>It&rsquo;s probably evident that applications designers need to very carefully design their message handlers to create a blockchain that does anything useful but this architecture provides a place to start.</p>

<h3 id="a-note-on-determinism:9ee5291616336eaccb53b94be2d99fab">A Note on Determinism</h3>

<p>The logic for blockchain transaction processing must be deterministic.  If the application logic weren&rsquo;t deterministic, consensus would not be reached among the Tendermint Core replica nodes.</p>

<p>Solidity on Ethereum is a great language of choice for blockchain applications because, among other reasons, it is a completely deterministic programming language.  However, it&rsquo;s also possible to create deterministic applications using existing popular languages like Java, C++, Python, or Go.  Game programmers and blockchain developers are already familiar with creating deterministic programs by avoiding sources of non-determinism such as:</p>

<ul>
<li>random number generators (without deterministic seeding)</li>
<li>race conditions on threads (or avoiding threads altogether)</li>
<li>the system clock</li>
<li>uninitialized memory (in unsafe programming languages like C or C++)</li>
<li><a href="http://gafferongames.com/networking-for-game-programmers/floating-point-determinism/">floating point arithmetic</a></li>
<li>language features that are random (e.g. map iteration in Go)</li>
</ul>

<p>While programmers can avoid non-determinism by being careful, it is also possible to create a special linter or static analyzer for each language to check for determinism.  In the future we may work with partners to create such tools.</p>

<h3 id="tutorials:9ee5291616336eaccb53b94be2d99fab">Tutorials</h3>

<p>Follow these tutorials to quickly get started developing your TMSP application.</p>

<ul>
<li><a href="/tutorials/run-your-first-tmsp-application/">Run your first TMSP application</a></li>
<li><a href="/tutorials/launch-a-tmsp-testnet/">Launch a TMSP testnet</a></li>
</ul>

<h3 id="contributions:9ee5291616336eaccb53b94be2d99fab">Contributions</h3>

<p><em>Many thanks to Zaki Manian for providing the &ldquo;Intro to TMSP&rdquo; section</em></p>

    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    


<div id="article-prev-next" class="container">
  
    <a id="article-prev" class="article-prev-next" href="http://tendermint.com/posts/tendermint-for-fast-settlement/">
      <div class="arrow">&lsaquo;</div>
      <div class="text">
        <div class="label">Previous Post</div>
        <div class="title">Tendermint for Fast Settlement</div>
      </div>
    </a>
  

  
</div>

  </section>


<section id="section-cta" class="section-dark">
<div class="container">
  <div class="section-header">
    <h2>Stay updated on Tendermint news</h2>
  </div>
  
<form action="http://tendermint.us8.list-manage1.com/subscribe/post?u=89d5a312be95ee3f0c9cf7ecd&amp;id=4af1217bca" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>

  <input type="email" name="EMAIL" id="mce-EMAIL" placeholder="Enter your email">

  <button type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">Subscribe to newsletter</button>

  
  <div style="position: absolute; left: -5000px;"><input type="text" name="b_89d5a312be95ee3f0c9cf7ecd_4af1217bca" tabindex="-1" value=""></div>

</form>


</div>
</section>

<footer id="site-footer" class="site-bookend">

<div class="site-logo">
  <a href="/"><img src="images/tm-logo-white-640.png" alt="Tendermint logo"/></a>
</div>

<p class="left">
&copy; 2015 Tendermint
</p>

<p class="right">
<a href="https://www.facebook.com/tendermint/">Facebook</a>
&middot;
<a href="mailto:hello@tendermint.com">Contact</a>
</p>
</footer>


<script src="scripts/highlight.pack.js"></script>
<script>
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-51029217-1', 'tendermint.com');
  ga('send', 'pageview');
</script>



</body>
</html>

